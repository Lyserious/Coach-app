<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:Coach_app.ViewModels.Groups"
             x:Class="Coach_app.Views.Groups.GroupSessionsView"
             Title="Gestion Calendrier">

    <Grid RowDefinitions="Auto, *">

        <Frame Grid.Row="0" BackgroundColor="White" Padding="15" HasShadow="True" Margin="0,0,0,10" CornerRadius="0">
            <VerticalStackLayout Spacing="10">
                <Label Text="Ajouter une séance" FontAttributes="Bold" TextColor="{StaticResource Primary}"/>

                <Grid ColumnDefinitions="*, Auto">
                    <DatePicker Date="{Binding NewDate, Mode=TwoWay}" Format="dddd dd MMMM" Grid.Column="0"/>

                    <Button Text="+ Ajouter" Command="{Binding AddSessionCommand}" Grid.Column="1" 
                            BackgroundColor="{StaticResource Primary}" TextColor="White" HeightRequest="35" Padding="10,0"/>
                </Grid>

                <Grid ColumnDefinitions="*, Auto, *">
                    <TimePicker Time="{Binding NewStartTime}" Grid.Column="0"/>
                    <Label Text="à" HorizontalOptions="Center" VerticalOptions="Center" Grid.Column="1"/>
                    <TimePicker Time="{Binding NewEndTime}" Grid.Column="2"/>
                </Grid>
            </VerticalStackLayout>
        </Frame>

        <CollectionView Grid.Row="1" ItemsSource="{Binding Sessions}" Margin="15">
            <CollectionView.EmptyView>
                <Label Text="Aucune séance prévue." HorizontalOptions="Center" VerticalOptions="Center" TextColor="Gray"/>
            </CollectionView.EmptyView>

            <CollectionView.ItemTemplate>
                <DataTemplate>

                    <Frame Margin="0,0,0,10" Padding="10" CornerRadius="10" BackgroundColor="#F5F5F5" BorderColor="Transparent">

                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type vm:GroupSessionsViewModel}}, Path=GoToSessionCommand}" CommandParameter="{Binding .}"/>
                        </Frame.GestureRecognizers>

                        <Grid ColumnDefinitions="Auto, *, Auto">

                            <VerticalStackLayout Grid.Column="0" WidthRequest="60" VerticalOptions="Center">
                                <Label Text="{Binding Date, StringFormat='{0:dd}'}" 
                                       FontSize="24" FontAttributes="Bold" HorizontalOptions="Center" TextColor="{StaticResource Primary}"/>
                                <Label Text="{Binding Date, StringFormat='{0:MMM}'}" 
                                       FontSize="12" HorizontalOptions="Center" TextColor="Gray" TextTransform="Uppercase"/>
                            </VerticalStackLayout>

                            <VerticalStackLayout Grid.Column="1" VerticalOptions="Center" Spacing="2">
                                <Label Text="{Binding Date, StringFormat='{0:dddd dd MMMM}'}" FontAttributes="Bold" TextColor="Black"/>
                                <Label Text="{Binding StartTime, StringFormat='{0:hh\\:mm} - ...'}" TextColor="Gray" FontSize="12"/>
                            </VerticalStackLayout>

                            <ImageButton Grid.Column="2" Source="dotnet_bot.png" HeightRequest="30" WidthRequest="30"
                                         BackgroundColor="Transparent"
                                         Command="{Binding Source={RelativeSource AncestorType={x:Type vm:GroupSessionsViewModel}}, Path=DeleteSessionCommand}" 
                                         CommandParameter="{Binding .}"/>
                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </Grid>
</ContentPage>