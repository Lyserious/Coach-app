<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:Coach_app.ViewModels.Groups"
             x:Class="Coach_app.Views.Groups.GroupSessionsView"
             Title="Gestion Calendrier"
             BackgroundColor="#F5F5F5">

    <Grid RowDefinitions="Auto, *">

        <Frame Grid.Row="0" BackgroundColor="White" Padding="15" HasShadow="True" Margin="10" CornerRadius="15">
            <VerticalStackLayout Spacing="15">
                <Label Text="Planifier une nouvelle sÃ©ance" FontAttributes="Bold" TextColor="Black" FontSize="16"/>

                <VerticalStackLayout Spacing="5">
                    <Label Text="Date de la sÃ©ance" FontSize="12" TextColor="Gray"/>
                    <Border Stroke="#DDD" StrokeThickness="1" StrokeShape="RoundRectangle 5" Padding="10">
                        <DatePicker Date="{Binding NewDate, Mode=TwoWay}" 
                                    Format="dddd dd MMMM yyyy" 
                                    TextColor="{StaticResource Primary}" 
                                    FontSize="16" 
                                    HorizontalOptions="Fill"/>
                    </Border>
                </VerticalStackLayout>

                <Grid ColumnDefinitions="*, Auto, *">
                    <VerticalStackLayout Grid.Column="0" Spacing="5">
                        <Label Text="DÃ©but" FontSize="12" TextColor="Gray" HorizontalOptions="Center"/>
                        <TimePicker Time="{Binding NewStartTime}" TextColor="Black" HorizontalOptions="Center"/>
                    </VerticalStackLayout>

                    <Label Text="Ã " Grid.Column="1" VerticalOptions="Center" TextColor="Gray"/>

                    <VerticalStackLayout Grid.Column="2" Spacing="5">
                        <Label Text="Fin" FontSize="12" TextColor="Gray" HorizontalOptions="Center"/>
                        <TimePicker Time="{Binding NewEndTime}" TextColor="Black" HorizontalOptions="Center"/>
                    </VerticalStackLayout>
                </Grid>

                <Button Text="Ajouter au calendrier" 
                        Command="{Binding AddSessionCommand}" 
                        BackgroundColor="Black" 
                        TextColor="White" 
                        CornerRadius="25" 
                        HeightRequest="45"
                        FontAttributes="Bold"/>
            </VerticalStackLayout>
        </Frame>

        <CollectionView Grid.Row="1" ItemsSource="{Binding Sessions}" Margin="10,0">
            <CollectionView.EmptyView>
                <Label Text="Aucune sÃ©ance prÃ©vue." HorizontalOptions="Center" VerticalOptions="Center" TextColor="Gray"/>
            </CollectionView.EmptyView>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame Margin="0,5" Padding="15" CornerRadius="10" BackgroundColor="White" BorderColor="Transparent">
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type vm:GroupSessionsViewModel}}, Path=GoToSessionCommand}" CommandParameter="{Binding .}"/>
                        </Frame.GestureRecognizers>

                        <Grid ColumnDefinitions="Auto, *, Auto">
                            <Border Grid.Column="0" Stroke="Black" StrokeThickness="2" WidthRequest="50" HeightRequest="50" StrokeShape="RoundRectangle 10" VerticalOptions="Center" Margin="0,0,15,0">
                                <VerticalStackLayout VerticalOptions="Center" Spacing="0">
                                    <Label Text="{Binding Date, StringFormat='{0:dd}'}" FontSize="18" FontAttributes="Bold" HorizontalOptions="Center" TextColor="Black"/>
                                    <Label Text="{Binding Date, StringFormat='{0:MMM}'}" FontSize="10" HorizontalOptions="Center" TextColor="Black" TextTransform="Uppercase"/>
                                </VerticalStackLayout>
                            </Border>

                            <VerticalStackLayout Grid.Column="1" VerticalOptions="Center" Spacing="2">
                                <Label Text="{Binding Date, StringFormat='{0:dddd dd MMMM}'}" FontAttributes="Bold" TextColor="Black" FontSize="16"/>
                                <Label Text="{Binding StartTime, StringFormat='{0:hh\\:mm} - ...'}" TextColor="Gray" FontSize="14"/>
                            </VerticalStackLayout>

                            <Button Grid.Column="2" Text="ðŸ—‘ï¸" 
                                    BackgroundColor="Transparent" TextColor="Red"
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type vm:GroupSessionsViewModel}}, Path=DeleteSessionCommand}" 
                                    CommandParameter="{Binding .}"/>
                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </Grid>
</ContentPage>