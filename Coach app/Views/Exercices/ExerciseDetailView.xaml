<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:Coach_app.ViewModels.Exercises"
             xmlns:models="clr-namespace:Coach_app.Models"
             x:Class="Coach_app.Views.Exercises.ExerciseDetailView"
             Title="{Binding Title}"
             BackgroundColor="#F5F5F5">

    <Grid>
        <ScrollView IsVisible="{Binding IsReadMode}">
            <Grid RowDefinitions="*, Auto">
                <VerticalStackLayout Spacing="20" Padding="20">

                    <Frame BackgroundColor="White" CornerRadius="15" HasShadow="True" Padding="20">
                        <VerticalStackLayout Spacing="5">
                            <Label Text="{Binding Name}" FontSize="26" FontAttributes="Bold" TextColor="{StaticResource Primary}"/>
                            <Label Text="{Binding SelectedCategory}" FontSize="14" TextColor="Gray" TextTransform="Uppercase"/>
                            <Label Text="{Binding ScoringType, StringFormat='Notation : {0}'}" FontSize="12" TextColor="Gray"/>
                        </VerticalStackLayout>
                    </Frame>

                    <Button Text="â–¶ï¸ Voir la VidÃ©o / Lien"
                            Command="{Binding OpenMediaCommand}"
                            IsVisible="{Binding HasMedia}"
                            BackgroundColor="#CC0000" 
                            TextColor="White"
                            FontAttributes="Bold"
                            CornerRadius="10"
                            HeightRequest="50"/>

                    <Grid ColumnDefinitions="*, *" ColumnSpacing="10">
                        <Frame BackgroundColor="#E3F2FD" Padding="15" CornerRadius="10" BorderColor="Transparent">
                            <VerticalStackLayout>
                                <Label Text="ðŸŽ¯ OBJECTIF" FontSize="10" TextColor="#1565C0" FontAttributes="Bold"/>
                                <Label Text="{Binding Goal}" TextColor="#0D47A1" FontSize="14"/>
                            </VerticalStackLayout>
                        </Frame>
                        <Frame BackgroundColor="#FFF3E0" Padding="15" CornerRadius="10" BorderColor="Transparent">
                            <VerticalStackLayout>
                                <Label Text="ðŸŽ’ MATÃ‰RIEL" FontSize="10" TextColor="#EF6C00" FontAttributes="Bold"/>
                                <Label Text="{Binding Equipment}" TextColor="#E65100" FontSize="14"/>
                            </VerticalStackLayout>
                        </Frame>
                    </Grid>

                    <Frame BackgroundColor="White" CornerRadius="10" Padding="15">
                        <VerticalStackLayout Spacing="10">
                            <Label Text="ðŸ“‹ Consignes &amp; ExÃ©cution" FontAttributes="Bold" FontSize="16"/>
                            <Label Text="{Binding Description}" LineBreakMode="WordWrap" FontSize="15" TextColor="#333"/>
                        </VerticalStackLayout>
                    </Frame>

                    <Frame BackgroundColor="White" CornerRadius="10" Padding="15" BorderColor="{StaticResource Primary}">
                        <VerticalStackLayout Spacing="10">
                            <Label Text="ðŸ’¡ Le Conseil du Coach" FontAttributes="Bold" FontSize="16" TextColor="{StaticResource Primary}"/>
                            <Label Text="{Binding Comments}" FontAttributes="Italic" TextColor="Black"/>
                        </VerticalStackLayout>
                    </Frame>

                    <BoxView HeightRequest="80" Color="Transparent"/>
                </VerticalStackLayout>

                <Button Grid.Row="1"
                        Text="âœï¸ Modifier la fiche" 
                        Command="{Binding EnableEditModeCommand}"
                        BackgroundColor="Black" TextColor="White"
                        Margin="20" CornerRadius="25" HeightRequest="50"
                        FontAttributes="Bold"
                        Shadow="{Shadow Brush=Black, Offset='0,5', Opacity=0.2}"/>
            </Grid>
        </ScrollView>

        <Grid IsVisible="{Binding IsEditMode}" RowDefinitions="*, Auto">
            <ScrollView Grid.Row="0" Padding="20">
                <VerticalStackLayout Spacing="15">

                    <Label Text="Mode Ã‰dition" TextColor="Red" FontAttributes="Bold" HorizontalOptions="Center"/>

                    <Frame Padding="15" CornerRadius="10">
                        <VerticalStackLayout Spacing="10">
                            <Label Text="GÃ©nÃ©ral" FontAttributes="Bold" TextColor="{StaticResource Primary}"/>
                            <Entry Placeholder="Nom de l'exercice" Text="{Binding Name}" FontSize="16"/>
                            <Label Text="CatÃ©gorie" FontSize="12" TextColor="Gray"/>
                            <Picker ItemsSource="{Binding Categories}" SelectedItem="{Binding SelectedCategory}"/>
                        </VerticalStackLayout>
                    </Frame>

                    <Frame Padding="15" CornerRadius="10">
                        <VerticalStackLayout Spacing="10">
                            <Label Text="SystÃ¨me de Notation" FontAttributes="Bold" TextColor="{StaticResource Primary}"/>
                            <Label Text="Comment Ã©valuer cet exercice ?" FontSize="10" TextColor="Gray"/>

                            <Picker SelectedItem="{Binding ScoringType}" Title="Choisir le type">
                                <Picker.ItemsSource>
                                    <x:Array Type="{x:Type models:PerformanceType}">
                                        <models:PerformanceType>Numeric</models:PerformanceType>
                                        <models:PerformanceType>Completion</models:PerformanceType>
                                        <models:PerformanceType>Level</models:PerformanceType>
                                    </x:Array>
                                </Picker.ItemsSource>
                            </Picker>
                        </VerticalStackLayout>
                    </Frame>

                    <Frame Padding="15" CornerRadius="10">
                        <VerticalStackLayout Spacing="10">
                            <Label Text="DÃ©tails Techniques" FontAttributes="Bold" TextColor="{StaticResource Primary}"/>

                            <Label Text="But / Objectif" FontSize="12" TextColor="Gray"/>
                            <Entry Placeholder="Gagner en force..." Text="{Binding Goal}"/>

                            <Label Text="MatÃ©riel" FontSize="12" TextColor="Gray"/>
                            <Entry Placeholder="Poutre, Ã©lastique..." Text="{Binding Equipment}"/>

                            <Label Text="Description" FontSize="12" TextColor="Gray"/>
                            <Editor Placeholder="Explique le mouvement..." Text="{Binding Description}" HeightRequest="100"/>

                            <Label Text="Astuces Coach" FontSize="12" TextColor="Gray"/>
                            <Editor Placeholder="Attention au dos..." Text="{Binding Comments}" HeightRequest="60"/>
                        </VerticalStackLayout>
                    </Frame>

                    <Frame Padding="15" CornerRadius="10">
                        <VerticalStackLayout Spacing="10">
                            <Label Text="MÃ©dia" FontAttributes="Bold" TextColor="{StaticResource Primary}"/>
                            <Label Text="Lien Youtube, Instagram ou Web" FontSize="10" TextColor="Gray"/>
                            <Entry Placeholder="https://..." Text="{Binding MediaUrl}"/>
                        </VerticalStackLayout>
                    </Frame>

                    <Button Text="ðŸ—‘ï¸ Archiver cet exercice" 
                            Command="{Binding DeleteCommand}" 
                            BackgroundColor="#FFEBEE" TextColor="Red" Margin="0,20,0,0"/>

                </VerticalStackLayout>
            </ScrollView>

            <Grid Grid.Row="1" ColumnDefinitions="*, *" ColumnSpacing="15" Padding="20" BackgroundColor="White">
                <Button Grid.Column="0" Text="Annuler" Command="{Binding CancelCommand}" 
                        BackgroundColor="Transparent" TextColor="Gray" BorderColor="Gray" BorderWidth="1"/>
                <Button Grid.Column="1" Text="Enregistrer" Command="{Binding SaveCommand}" 
                        BackgroundColor="{StaticResource Primary}" TextColor="White"/>
            </Grid>
        </Grid>

    </Grid>
</ContentPage>